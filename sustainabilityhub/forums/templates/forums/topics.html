{% extends 'base.html' %}

{% block title %}Forums{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <h1>Forums</h1>
        {% if user.is_authenticated %}
            <a href="{% url 'forums:topic_create' %}" class="btn">New Topic</a>
        {% endif %}
    </div>
    
    <form method="get" style="margin-bottom: 1rem;">
        <input type="text" name="search" placeholder="Search topics..." value="{{ request.GET.search }}" style="padding: 0.5rem; width: 300px;">
        <button type="submit" class="btn">Search</button>
    </form>
    
    <div style="margin-bottom: 1rem; display:flex; flex-wrap:wrap; gap:0.5rem;">
        <a href="{% url 'forums:topics' %}" 
           class="btn btn-secondary {% if not request.GET.category %}active{% endif %}">
           All Topics
        </a>
        {% for category in categories %}
            <a href="?category={{ category.id }}" 
               class="btn btn-secondary {% if request.GET.category == category.id|stringformat:'s' %}active{% endif %}">
               {{ category.name }}
            </a>
        {% endfor %}
    </div>
    
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background-color: #f0f0f0; padding: 0.5rem;">
                <th style="text-align: left; padding: 0.5rem;">Topic</th>
                <th style="text-align: left; padding: 0.5rem;">Author</th>
                <th style="text-align: left; padding: 0.5rem;">Category</th>
                <th style="text-align: left; padding: 0.5rem;">Replies</th>
                <th style="text-align: left; padding: 0.5rem;">Views</th>
                <th style="text-align: left; padding: 0.5rem;">Last Post</th>
            </tr>
        </thead>
        <tbody>
            {% for topic in topics %}
                <tr style="border-bottom: 1px solid #ddd;">
                    <td style="padding: 0.5rem;">
                        {% if topic.is_pinned %}ðŸ“Œ {% endif %}
                        <a href="{% url 'forums:topic_detail' pk=topic.pk %}">{{ topic.title }}</a>
                    </td>
                    <td style="padding: 0.5rem;">
                        <a href="{% url 'profiles:detail' username=topic.author.username %}">
                            {{ topic.author.username }}
                        </a>
                    </td>
                    <td style="padding: 0.5rem;">{{ topic.category.name|default:"Uncategorized" }}</td>
                    <td style="padding: 0.5rem;">{{ topic.post_count }}</td>
                    <td style="padding: 0.5rem;">{{ topic.views }}</td>
                    <td style="padding: 0.5rem;">{{ topic.updated_at|date:"M d, Y" }}</td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="6" style="padding: 1rem; text-align: center;">No topics found.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<style>
.btn.active {
    background-color: #2d8659 !important;
    color: white !important;
}
</style>
{% endblock %}
